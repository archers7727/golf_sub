// Prisma Schema for Golf Intranet
// This schema is based on existing Supabase database

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Enums
// Note: Most enums are stored as plain TEXT in the database with Korean values
// We use String type in models and handle validation in the application layer

enum UserType {
  MANAGER @map("manager")
  ADMIN   @map("admin")
}

enum ReservableCountType {
  TOTAL
  DAYEND
}

// Database stores Korean text values directly for these fields:
// - GolfRegion: "경기북부", "경기남부", "충청도", "경상남도", "강원도"
// - RequirementsType: "조건없음", "인회필", "예변필", "인회필/예변필"
// - CourseTimeStatus: "미판매", "판매완료", "타업체마감"
// - JoinType: "남", "여", "남남", "여여", "남녀", "양도", "남남남", "여여여", "남남여", "남여여"
// - JoinPersonStatus: "입금확인전", "입금확인중", "입금완료", "환불확인중", "환불완료"

// Models
model User {
  id            String    @id @default(uuid())
  type          UserType  @default(MANAGER)
  phoneNumber   String    @map("phone_number")
  name          String
  chargeRate    Float     @default(0) @map("charge_rate")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at")

  // Relations
  authoredCourseTimes CourseTime[] @relation("CourseTimeAuthor")
  blockedCourseTimes  CourseTime[] @relation("CourseTimeBlocker")
  joinPersons         JoinPerson[]
  blackLists          BlackList[]

  @@map("users")
}

model GolfClub {
  id                   String               @id @default(uuid())
  region               String               // Korean values: "경기북부", "경기남부", etc.
  name                 String
  cancelDeadlineDate   Int                  @default(0) @map("cancel_deadline_date")
  cancelDeadlineHour   Int                  @default(0) @map("cancel_deadline_hour")
  reservableCountType  ReservableCountType  @default(TOTAL) @map("reservable_count_type")
  reservableCount1     Int                  @default(0) @map("reservable_count_1")
  reservableCount2     Int                  @default(0) @map("reservable_count_2")
  hidden               Boolean              @default(false)
  createdAt            DateTime             @default(now()) @map("created_at")
  updatedAt            DateTime             @updatedAt @map("updated_at")
  deletedAt            DateTime?            @map("deleted_at")

  // Relations
  siteIds SiteId[]

  @@map("golf_clubs")
}

model Course {
  id           String     @id @default(uuid())
  clubId       String?    @map("club_id")
  region       String     // Korean values: "경기북부", "경기남부", etc.
  golfClubName String     @map("golf_club_name")
  courseName   String     @map("course_name")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  deletedAt    DateTime?  @map("deleted_at")

  // Relations
  courseTimes CourseTime[]

  @@map("courses")
}

model SiteId {
  id          String     @id @default(uuid())
  siteId      String     @map("site_id")
  name        String
  golfClubId  String?    @map("golf_club_id")
  disabled    Boolean    @default(false)
  hidden      Boolean    @default(false)
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  deletedAt   DateTime?  @map("deleted_at")

  // Relations
  golfClub    GolfClub?  @relation(fields: [golfClubId], references: [id])
  courseTimes CourseTime[]

  @@map("site_ids")
}

model CourseTime {
  id           String            @id @default(uuid())
  authorId     String?           @map("author_id")
  courseId     String?           @map("course_id")
  siteId       String?           @map("site_id")
  reservedTime DateTime          @map("reserved_time")
  reservedName String            @map("reserved_name")
  greenFee     Int               @default(0) @map("green_fee")
  chargeFee    Int               @default(0) @map("charge_fee")
  requirements String            @default("조건없음") // Korean values: "조건없음", "인회필", etc.
  flag         Int               @default(0)
  memo         String?
  status       String            @default("미판매") // Korean values: "미판매", "판매완료", "타업체마감"
  blockUntil   DateTime?         @map("block_until")
  blockerId    String?           @map("blocker_id")
  joinNum      Int               @default(0) @map("join_num")
  createdAt    DateTime          @default(now()) @map("created_at")
  updatedAt    DateTime          @updatedAt @map("updated_at")

  // Relations
  author      User?        @relation("CourseTimeAuthor", fields: [authorId], references: [id])
  blocker     User?        @relation("CourseTimeBlocker", fields: [blockerId], references: [id])
  course      Course?      @relation(fields: [courseId], references: [id])
  siteIdRel   SiteId?      @relation(fields: [siteId], references: [id])
  joinPersons JoinPerson[]

  @@map("course_times")
}

model JoinPerson {
  id            String           @id @default(uuid())
  managerId     String?          @map("manager_id")
  timeId        String?          @map("time_id")
  name          String
  joinType      String           @map("join_type") // Korean values: "남", "여", "남남", "양도", etc.
  joinNum       Int              @map("join_num")
  phoneNumber   String           @map("phone_number")
  greenFee      Int              @default(0) @map("green_fee")
  chargeFee     Int              @default(0) @map("charge_fee")
  chargeRate    Float            @default(0) @map("charge_rate")
  status        String           @default("입금확인전") // Korean values: "입금확인전", "입금확인중", etc.
  refundReason  String?          @map("refund_reason")
  refundAccount String?          @map("refund_account")
  createdAt     DateTime         @default(now()) @map("created_at")
  updatedAt     DateTime         @updatedAt @map("updated_at")

  // Relations
  manager    User?       @relation(fields: [managerId], references: [id])
  courseTime CourseTime? @relation(fields: [timeId], references: [id])

  @@map("join_persons")
}

model BlackList {
  id          String    @id @default(uuid())
  authorId    String?   @map("author_id")
  name        String
  phoneNumber String    @map("phone_number")
  reason      String
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")

  // Relations
  author User? @relation(fields: [authorId], references: [id])

  @@map("black_lists")
}

model Holiday {
  id        String   @id @default(uuid())
  date      DateTime @db.Date
  name      String
  createdAt DateTime @default(now()) @map("created_at")

  @@map("holidays")
}
